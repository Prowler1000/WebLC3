<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		%sveltekit.head%
	</head>
	<body class="dark">
		<div>%sveltekit.body%</div>

		<div id="invisible" style="visibility: hidden;">
			<div id="container" style="width: 1000px; height: 500px;"></div>
		</div>
		<script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
		<script>
			require.config({ paths: { vs: '../node_modules/monaco-editor/min/vs' } });

			require(['vs/editor/editor.main'], function () {
				monaco.languages.register({
					id: 'lc3Asm'
				});
				monaco.languages.setMonarchTokensProvider('lc3Asm', {
					defaultToken: "invalid",
					ignoreCase: true,

					instructions: [
						"add", "and", "br", "brn", "brz", "brp",
						"brnz", "brnp", "brzp", "brnzp", "jmp", "jsr",
						"jsrr", "ld", "ldi", "ldr", "lea", "not",
						"ret", "rti", "st", "sti", "str", "trap"
					],

					trapAliases: [
						"getc", "halt", "in", "out", "puts", "putsp"
					],

					origDirective: [
						".orig"
					],

					directives: [
						".end", ".fill", ".blkw", ".stringz"
					],

					symbols: /:/,
					escapes: /\\?:[nrt\\"']/,
					digits: /\d+/,
					binDigits: /[0-1]+/,
					hexDigits: /[0-9a-fA-F]+/,

					tokenizer: {
						root: [
							// registers
							[/[rR][0-7]/, "register"],

							// instructions, directives and labels
							[/[a-zA-Z_][\w]*/, {
								cases: {
									"@instructions": "instruction",
									"@trapAliases": "trapAlias",
									"@origDirective": "orig",
									"@directives": "directive",
									"@default": "label"
								}
							}],

							{include: "@whitespace"},

							// numbers
							[/0?[xX](@hexDigits)/, "hexNumber"],
							[/0?[bB](@binDigits)/, "binNumber"],
							[/(@digits)/, "number"],

							// delimiter
							[/,/, "delimiter"],

							// strings
							[/"([^"])*$/, "invalidString"],
							[/'([^'])*$/, "invalidString"],
							[/"/, "@doubleString"],
							[/'/, "@singleString"]
						],

						whitespace: [
							[/\s/, ''],
							[/;.*$/, "comment"]
						],

						doubleString: [
							[/[^"]+/, "string"],
							[/@escapes/, "stringEscape"],
							[/\\./, "invalidEscape"],
							[/"/, "string", "@pop"]
						],

						singleString: [
							[/[^']+/, "string"],
							[/@escapes/, "stringEscape"],
							[/\\./, "invalidEscape"],
							[/'/, "string", "@pop"]
						]
					}
				});

				// Define a new theme that contains only rules that match this language
				monaco.editor.defineTheme('myCoolTheme', {
					colors: {},
					base: 'vs',
					inherit: false,
					rules: [
						{ token: 'custom-info', foreground: '808080' },
						{ token: 'custom-error', foreground: 'ff0000', fontStyle: 'bold' },
						{ token: 'custom-notice', foreground: 'FFA500' },
						{ token: 'custom-date', foreground: '008800' }
					]
				});

				var editor = monaco.editor.create(document.getElementById('container'), {
					theme: 'myCoolTheme',
					value: getCode(),
					language: 'lc3Asm'
				});
			});

			function getCode() {
				return [
					'; comment',
					'.ORIG x3000',
					'LD      R1  NUM1',
					'ST		 r0, num1',
					'ADD     R0  R1  #0  ; comment',
					'add	 r0, r1, xF',
					'',
					'num1: .fill x20',
					'NUM2: .FILL #30',
					'NUM3:',
					'.fill b100010'
				].join('\n');
			}
		</script>
	</body>
</html>