<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
		%sveltekit.head%
	</head>
	<body class="dark">
		<div>%sveltekit.body%</div>

		<div id="invisible" style="visibility: hidden;">
			<div id="container" style="width: 1000px; height: 500px;"></div>
		</div>
		<script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
		<script>
			require.config({ paths: { vs: '../node_modules/monaco-editor/min/vs' } });

			require(['vs/editor/editor.main'], function () {
				monaco.languages.register({
					id: 'lc3Asm'
				});
				monaco.languages.setMonarchTokensProvider('lc3Asm', {
					defaultToken: "invalid",
					ignoreCase: true,

					instructions: [
						"add", "and", "br", "brn", "brz", "brp",
						"brnz", "brnp", "brzp", "brnzp", "jmp", "jsr",
						"jsrr", "ld", "ldi", "ldr", "lea", "not",
						"ret", "rti", "st", "sti", "str", "trap"
					],

					trapAliases: [
						"getc", "halt", "in", "out", "puts", "putsp"
					],

					origDirective: [
						".orig"
					],

					directives: [
						".end", ".fill", ".blkw", ".stringz"
					],

					digits: /\d+/,
					binDigits: /[0-1]+/,
					hexDigits: /[0-9a-fA-F]+/,

					tokenizer: {
						root: [
							// numbers
							[/#?[xX](@hexDigits)/, "hexNumber"],
							[/#?[bB](@binDigits)/, "binNumber"],
							[/#(@digits)/, "number"],

							// strings
							[/"([^"])*$/, "invalidString"],
							[/'([^'])*$/, "invalidString"],
							[/"/, "string", "@doubleString"],
							[/'/, "string", "@singleString"],

							// registers
							[/[rR][0-7]/, "register"],

							[/\.[\w]+/, {
								cases: {
									"@origDirective": "orig",
									"@directives": "directive",
									"@default": "invalid"
								}
							}],

							// instructions and labels
							[/[a-zA-Z_][\w]*/, {
								cases: {
									"@instructions": "instruction",
									"@trapAliases": "trapAlias",
									"@default": "label"
								}
							}],

							{include: "@whitespace"},

							// delimiter
							[/[,:]/, "delimiter"]
						],

						whitespace: [
							[/\s/, ''],
							[/;.*$/, "comment"]
						],

						doubleString: [
							[/[^"]+/, "string"],
							[/"/, "string", "@pop"]
						],

						singleString: [
							[/[^']+/, "string"],
							[/'/, "string", "@pop"]
						]
					}
				});

				// Define a new theme that contains only rules that match this language
				monaco.editor.defineTheme('lc3Theme', {
					colors: {},
					base: 'vs',
					inherit: false,
					rules: [
						{ token: 'register', foreground: '8446BA' },
						{ token: 'instruction', foreground: 'FF8000' },
						{ token: 'trapAlias', foreground: 'FFA500' },
						{ token: 'orig', foreground: 'FFEE88' },
						{ token: 'directive', foreground: '90E060'},
						{ token: 'label', foreground: '60B6FF'},
						{ token: 'number', foreground: 'FF0080'},
						{ token: 'hexNumber', foreground: 'FF0080'},
						{ token: 'binNumber', foreground: 'FF0080'},
						{ token: 'delimiter', foreground: 'FFFFFF'},
						{ token: 'invalidString', foreground: 'FF0000', fontStyle: 'bold'},
						{ token: 'comment', foreground: 'C0C0C0'},
						{ token: 'string', foreground: '70A965'},
						{ token: 'invalid', foreground: 'A00000', fontStyle: 'bold'}
					]
				});

				var editor = monaco.editor.create(document.getElementById('container'), {
					theme: 'lc3Theme',
					value: getCode(),
					language: 'lc3Asm'
				});
			});

			function getCode() {
				return [
					'; comment',
					'.ORIG x3000',
					'LD      R1  NUM2',
					'ST      r0, num1',
					'ADD     R0  R1  #0  ; comment',
					'add     r0, r1, xF',
					'',
					'num1: .fill x20',
					'NUM2: .FILL #30',
					'NUM3:',
					'.fill b100010',
					'num4: .fill #x40',
					'.stringz "hello\\n"',
					'.stringz \'hello\\n\''
				].join('\n');
			}
		</script>
	</body>
</html>