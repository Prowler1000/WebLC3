<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset='utf-8'>
        <meta name='viewport' content='width=device-width,initial-scale=1'>
        <meta property="og:title" content="WebLC3 Simulator"/>
        <meta property="og:image" content="https://github.com/aidan-garvey/WebLC3/blob/main/static/weblc3_preview.png" />
        <meta property="og:description" content="Web-based editor and simulator for Little Computer 3 (LC-3)" />
        <!-- <meta property="og:url" content="https://to-be-decided" /> -->
        <meta property="og:image:width" content="1280" />
        <meta property="og:image:height" content="640" />

        <title> WebLC3 Simulator </title>

		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
		%sveltekit.head%
	</head>
	<body class="dark">
		<div>%sveltekit.body%</div>

		<div id="invisible" style="visibility: hidden; height: 1px;">
			<div id="container" style="width: 1000px; height: 500px;"></div>
		</div>
		<script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
		<script>
			require.config({ paths: { vs: '../node_modules/monaco-editor/min/vs' } });

			require(['vs/editor/editor.main'], function () {
				monaco.languages.register({
					id: 'lc3Asm'
				});
				monaco.languages.setMonarchTokensProvider('lc3Asm', {
					defaultToken: "invalid",
					ignoreCase: true,

					instructions: [
						"add", "and", "br", "brn", "brz", "brp",
						"brnz", "brnp", "brzp", "brnzp", "jmp", "jsr",
						"jsrr", "ld", "ldi", "ldr", "lea", "not",
						"ret", "rti", "st", "sti", "str", "trap"
					],

					trapAliases: [
						"getc", "halt", "in", "out", "puts", "putsp"
					],

					origDirective: [
						".orig"
					],

					directives: [
						".end", ".fill", ".blkw", ".stringz"
					],

					digits: /\d+/,
					binDigits: /[0-1]+/,
					hexDigits: /[0-9a-fA-F]+/,

					tokenizer: {
						root: [
							// numbers
							[/#?[xX](@hexDigits)/, "hexNumber"],
							[/#?[bB](@binDigits)/, "binNumber"],
							[/#?-?(@digits)/, "number"],

							// strings
							[/"([^"])*$/, "invalidString"],
							[/'([^'])*$/, "invalidString"],
							[/"/, "string", "@doubleString"],
							[/'/, "string", "@singleString"],

							// registers
							[/[rR][0-7]/, "register"],

							[/\.[\w]+/, {
								cases: {
									"@origDirective": "orig",
									"@directives": "directive",
									"@default": "invalid"
								}
							}],

							// instructions and labels
							[/[a-zA-Z_][\w]*/, {
								cases: {
									"@instructions": "instruction",
									"@trapAliases": "trapAlias",
									"@default": "label"
								}
							}],

							{include: "@whitespace"},

							// delimiter
							[/[,:]/, "delimiter"]
						],

						whitespace: [
							[/\s/, ''],
							[/;.*$/, "comment"]
						],

						doubleString: [
							[/[^"]+/, "string"],
							[/"/, "string", "@pop"]
						],

						singleString: [
							[/[^']+/, "string"],
							[/'/, "string", "@pop"]
						]
					}
				});

				// Define a new theme that contains only rules that match this language
				monaco.editor.defineTheme('lc3Theme', {
					colors: {},
					base: 'vs',
					inherit: false,
					rules: [
						{ token: 'register', foreground: '8786CC' },
						{ token: 'instruction', foreground: 'FFAB40' },
						{ token: 'trapAlias', foreground: 'FFAB40' },
						{ token: 'orig', foreground: 'F6F180' },
						{ token: 'directive', foreground: '90D050'},
						{ token: 'label', foreground: '60B6FF'},
						{ token: 'number', foreground: 'CE608C'},
						{ token: 'hexNumber', foreground: 'CE608C'},
						{ token: 'binNumber', foreground: 'CE608C'},
						{ token: 'delimiter', foreground: 'F0F0F0'},
						{ token: 'invalidString', foreground: 'FF3724', fontStyle: 'bold'},
						{ token: 'comment', foreground: '8F878C'},
						{ token: 'string', foreground: '80B49A'},
						{ token: 'invalid', foreground: 'C33333', fontStyle: 'bold'}
					]
				});

				globalThis.editor = monaco.editor.create(document.getElementById('container'), {
					theme: 'lc3Theme',
					value: getCode(),
					language: 'lc3Asm'
				});
				
			});

			function getCode() {
				return [
				'; comment',
				'',
				'.orig x3000',
				'',
				'	ld  R6, stack',
				'	lea R0, hello',
				'	puts',
				'	halt',
				'',
				'stack .fill xE000',
				'hello .stringz "Hello World!\\n"',
				'.end'
				].join('\n');
			}
		</script>
	</body>
</html>